{% extends "base.html" %}

{% block title %}å¯¶ç®±å»£å‘Šå»ºç«‹{% endblock %}

{% block page_title %}å»ºç«‹å¯¶ç®±å»£å‘Š{% endblock %}

{% block additional_styles %}
<style>
    .treasure-box-controls {
        margin-top: 20px;
        margin-bottom: 20px;
    }
    .treasure-item {
        border: 1px solid #ddd;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 5px;
        background-color: #f9f9f9;
    }
    .clear-form-btn {
        background-color: #f44336;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-bottom: 15px;
    }
    .clear-form-btn:hover {
        background-color: #d32f2f;
    }
    .main-content-wrapper {
        display: flex;
        align-items: flex-start;
        gap: 20px;
    }
    .form-column {
        flex: 1;
        min-width: 0;
    }
    .preview-column {
        width: 300px;
        flex-shrink: 0;
        position: sticky;
        top: 20px;
    }
    .ad-preview-container {
        width: 300px;
        height: 250px;
        border: 2px solid #333;
        margin: 0;
        display: flex;
        flex-direction: column;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        background-color: #000;
        overflow: hidden;
    }
    .ad-preview-header {
        padding: 2px 8px;
        font-size: 12px;
        color: #cd9601;
        text-align: left;
    }
    .ad-preview-main {
        flex-grow: 1;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        height: 157px;
        background-color: #000;
    }
    .ad-preview-title {
        padding: 4px 8px;
        font-weight: bold;
        font-size: 14px;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: white;
    }
    .ad-preview-subtitle {
        padding: 4px 8px;
        font-size: 12px;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: gray;
    }
    .ad-preview-footer {
        display: flex;
        font-size: 12px;
    }
    .ad-preview-advertiser {
        flex-grow: 1;
        padding: 4px 8px;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: gray;
    }
    .ad-preview-cta {
        padding: 4px 12px;
        font-weight: bold;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        background-color: #0d6efd;
        color: white;
        border-radius: 5px;
        margin: 4px;
    }
    #preview-treasure-box {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        background-size: cover;
        background-position: center;
    }
    .treasure-box-container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .treasure-items-row {
        display: flex;
        align-items: center;
        justify-content: space-around;
        width: 80%;
        height: 100%;
    }
    .treasure-item-preview {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        border: none;
        object-fit: cover;
        cursor: pointer;
    }
    .form-group-section {
        background: #f8f9fa;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
        border: 1px solid #e9ecef;
    }
    .section-title {
        color: #495057;
        font-weight: 600;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid #dee2e6;
    }
    
    /* å¯¶ç®±è¨­å®šæ‘ºç–ŠåŠŸèƒ½æ¨£å¼ */
    .treasure-box-toggle {
        background-color: #17a2b8;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 15px 20px;
        margin-bottom: 20px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 500;
        transition: background-color 0.2s ease;
    }
    
    .treasure-box-toggle:hover {
        background-color: #138496;
    }
    
    .treasure-box-toggle::after {
        content: 'â–¼';
        font-size: 14px;
        transition: transform 0.3s ease;
    }
    
    .treasure-box-toggle.collapsed::after {
        transform: rotate(-90deg);
    }
    
    .treasure-box-section {
        display: none;
        margin-bottom: 20px;
    }
    
    .treasure-box-section.expanded {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="main-content-wrapper">
    <div class="form-column">
        <form action="{{ url_for('main.clear_treasure_box_form') }}" method="post" style="display: inline;">
            <button type="submit" class="clear-form-btn" onclick="return confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å¡«å¯«çš„å…§å®¹å—ï¼Ÿ')">æ¸…é™¤æ‰€æœ‰å…§å®¹</button>
        </form>

        <form action="{{ url_for('main.create_treasure_box_ad') }}" method="post" id="ad-form">
            <div class="field-group">
                <h3>ğŸ“‹ åŸºæœ¬å»£å‘Šè³‡è¨Š</h3>
                
                <div class="form-grid-2">
                    <div class="form-row">
                        <label for="adset_id">Adset ID <span class="required">*</span></label>
                        <input type="text" id="adset_id" name="adset_id" value="{{ form_data.get('adset_id', '') }}" required
                               placeholder="ä¾‹å¦‚ï¼š00947c1b-f7cd-47c6-a23a-0639e9702cc7">
                        <div class="help-text">å»£å‘Šçµ„IDï¼Œå¿…å¡«</div>
                    </div>
                    
                    <div class="form-row">
                        <label for="display_name">å»£å‘Šå–®å…ƒé¡¯ç¤ºåç¨±</label>
                        <input type="text" id="display_name" name="display_name" value="{{ form_data.get('display_name', '') }}"
                               placeholder="åƒ…ä¾›å¾Œå°é¡¯ç¤ºä½¿ç”¨">
                        <div class="help-text">åƒ…é¡¯ç¤ºæ–¼å¾Œå°ï¼Œå¯é¸</div>
                    </div>
                </div>
                
                <div class="form-grid-2">
                    <div class="form-row">
                        <label for="advertiser">å»£å‘Šå•† <span class="required">*</span></label>
                        <input type="text" id="advertiser" name="advertiser" value="{{ form_data.get('advertiser', '') }}" required
                               placeholder="å»£å‘Šä¸»åç¨±">
                        <div class="help-text">å»£å‘Šä¸»åç¨±ï¼Œå¿…å¡«</div>
                    </div>
                    
                    <div class="form-row">
                        <label for="main_title">ä¸»æ¨™é¡Œ <span class="required">*</span></label>
                        <input type="text" id="main_title" name="main_title" value="{{ form_data.get('main_title', '') }}" required
                               placeholder="å»£å‘Šä¸»æ¨™é¡Œ">
                        <div class="help-text">å»£å‘Šä¸»æ¨™é¡Œï¼Œå¿…å¡«</div>
                    </div>
                </div>
                
                <div class="form-grid-2">
                    <div class="form-row">
                        <label for="subtitle">æ–‡å­—æ•˜è¿°</label>
                        <input type="text" id="subtitle" name="subtitle" value="{{ form_data.get('subtitle', '') }}"
                               placeholder="å»£å‘Šå‰¯æ¨™é¡Œï¼ˆå¯é¸ï¼‰">
                        <div class="help-text">å»£å‘Šå‰¯æ¨™é¡Œï¼Œå¯é¸</div>
                    </div>
                    
                    <div class="form-row">
                        <label for="call_to_action">è¡Œå‹•å‘¼ç±²æŒ‰éˆ•æ–‡å­—</label>
                        <input type="text" id="call_to_action" name="call_to_action" value="{{ form_data.get('call_to_action', 'ç«‹å³äº†è§£') }}"
                               placeholder="ç«‹å³äº†è§£">
                        <div class="help-text">CTAæŒ‰éˆ•æ–‡å­—ï¼Œé è¨­ç‚ºã€Œç«‹å³äº†è§£ã€</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <label for="landing_page">åˆ°é”é é¢ç¶²å€ <span class="required">*</span></label>
                    <input type="url" id="landing_page" name="landing_page" placeholder="https://example.com" 
                           value="{{ form_data.get('landing_page', '') }}" required>
                    <div class="help-text">ç”¨æˆ¶é»æ“Šå»£å‘Šå¾Œè·³è½‰çš„ç¶²å€ï¼Œå¿…å¡«</div>
                </div>
            </div>

            <div class="field-group">
                <h3>å»£å‘Šç´ æ</h3>
                <p style="margin-bottom: 20px; color: #666; font-style: italic;">
                    æ‰€æœ‰åœ–ç‰‡å‡ç‚ºå¿…å¡«ã€‚è«‹æä¾›æœ¬åœ°å®Œæ•´æª”æ¡ˆè·¯å¾‘ï¼Œæˆ–ä½¿ç”¨ä¸Šå‚³åŠŸèƒ½ã€‚
                </p>
                
                <div class="form-grid-2">
                    <div class="form-row">
                        <label for="image_path_m">å¤§å°ºå¯¸åœ–ç‰‡ 1200x628 <span class="required">*</span></label>
                        <div class="file-upload-container">
                            <input type="text" id="image_path_m" name="image_path_m" 
                                   placeholder="/path/to/your/image_1200x628.jpg" 
                                   value="{{ form_data.get('image_path_m', '') }}" required>
                            <div class="help-text">å¤§å‹æ©«å¹…åœ–ç‰‡ï¼Œå°ºå¯¸1200x628åƒç´ </div>
                            <div class="preview-container">
                                <label class="custom-file-upload">
                                    ğŸ“ ä¸Šå‚³åœ–ç‰‡
                                    <input type="file" class="file-input" data-target="image_path_m" accept="image/*">
                                </label>
                                <img id="preview_m" class="upload-preview" style="display: none;" alt="é è¦½åœ–">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <label for="image_path_s">å°å°ºå¯¸åœ–ç‰‡ 300x300 <span class="required">*</span></label>
                        <div class="file-upload-container">
                            <input type="text" id="image_path_s" name="image_path_s" 
                                   placeholder="/path/to/your/image_300x300.jpg" 
                                   value="{{ form_data.get('image_path_s', '') }}" required>
                            <div class="help-text">æ–¹å½¢åœ–ç‰‡ï¼Œå°ºå¯¸300x300åƒç´ </div>
                            <div class="preview-container">
                                <label class="custom-file-upload">
                                    ğŸ“ ä¸Šå‚³åœ–ç‰‡
                                    <input type="file" class="file-input" data-target="image_path_s" accept="image/*">
                                </label>
                                <img id="preview_s" class="upload-preview" style="display: none;" alt="é è¦½åœ–">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <label for="background_image">äº’å‹•å»£å‘Šå¢Šæª”èƒŒæ™¯ <span class="required">*</span></label>
                    <input type="text" id="background_image" name="background_image" 
                           placeholder="è«‹è¼¸å…¥èƒŒæ™¯åœ–ç‰‡ç¶²å€" value="{{ form_data.get('background_image', '') }}" required>
                    <div class="help-text">äº’å‹•å»£å‘Šå¢Šæª”èƒŒæ™¯åœ–ç‰‡ç¶²å€</div>
                </div>

                <div class="form-row">
                    <label for="img_background">èƒŒæ™¯åœ–ç‰‡ URL <span class="required">*</span></label>
                    <input type="text" id="img_background" name="img_background" 
                           value="{{ form_data.get('img_background', '') }}" required
                           placeholder="å¯¶ç®±éŠæˆ²èƒŒæ™¯åœ–ç‰‡ç¶²å€">
                    <div class="help-text">å¯¶ç®±éŠæˆ²èƒŒæ™¯åœ–ç‰‡</div>
                </div>
            </div>

            <!-- å¯¶ç®±éŠæˆ²è¨­å®šæ‘ºç–Šå€å¡Š -->
            <div class="treasure-box-toggle collapsed">
                <span>ğŸ å¯¶ç®±éŠæˆ²è¨­å®šï¼ˆé€²éšé¸é …ï¼‰</span>
            </div>
            <div class="treasure-box-section">
                <div class="form-group-section">
                    <div class="form-grid-2">
                        <div class="form-row">
                            <label for="img_logo">å“ç‰Œ Logo åœ–ç‰‡ URL</label>
                            <input type="text" id="img_logo" name="img_logo" 
                                   value="{{ form_data.get('img_logo', '') }}"
                                   placeholder="å“ç‰Œ Logo åœ–ç‰‡ç¶²å€">
                            <div class="help-text">é¡¯ç¤ºåœ¨å¯¶ç®±éŠæˆ²ä¸­çš„å“ç‰ŒLogo</div>
                        </div>
                    </div>
                    
                    <h6 style="margin-top: 20px; margin-bottom: 10px;">å¯¶ç®±åœ–ç‰‡è¨­å®š</h6>
                    <div class="form-grid-3">
                        <div class="form-row">
                            <label for="img_item_idle">å¯¶ç®±é–’ç½®ç‹€æ…‹</label>
                            <input type="text" id="img_item_idle" name="img_item_idle" 
                                   value="{{ form_data.get('img_item_idle', '') }}"
                                   placeholder="å¯¶ç®±é–’ç½®æ™‚çš„åœ–ç‰‡ç¶²å€">
                        </div>
                        
                        <div class="form-row">
                            <label for="img_item_pressed">å¯¶ç®±æŒ‰ä¸‹ç‹€æ…‹</label>
                            <input type="text" id="img_item_pressed" name="img_item_pressed" 
                                   value="{{ form_data.get('img_item_pressed', '') }}"
                                   placeholder="å¯¶ç®±è¢«æŒ‰ä¸‹æ™‚çš„åœ–ç‰‡ç¶²å€">
                        </div>
                        
                        <div class="form-row">
                            <label for="img_item_activated">å¯¶ç®±æ¿€æ´»ç‹€æ…‹</label>
                            <input type="text" id="img_item_activated" name="img_item_activated" 
                                   value="{{ form_data.get('img_item_activated', '') }}"
                                   placeholder="å¯¶ç®±æ¿€æ´»æ™‚çš„åœ–ç‰‡ç¶²å€">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group-section">
                <h5 class="section-title">ğŸ† çå“è¨­å®š</h5>
                
                <h6>çå“ 1</h6>
                <div class="form-grid-2">
                    <div class="form-row">
                        <label for="items_active_1">æ¿€æ´»ç‹€æ…‹åœ–ç‰‡ <span class="required">*</span></label>
                        <input type="text" id="items_active_1" name="items_active_1" 
                               value="{{ form_data.get('items_active_1', '') }}" required
                               placeholder="çå“1æ¿€æ´»æ™‚çš„åœ–ç‰‡ç¶²å€">
                    </div>
                    
                    <div class="form-row">
                        <label for="items_idle_1">é–’ç½®ç‹€æ…‹åœ–ç‰‡ <span class="required">*</span></label>
                        <input type="text" id="items_idle_1" name="items_idle_1" 
                               value="{{ form_data.get('items_idle_1', '') }}" required
                               placeholder="çå“1é–’ç½®æ™‚çš„åœ–ç‰‡ç¶²å€">
                    </div>
                </div>
                
                <h6>çå“ 2</h6>
                <div class="form-grid-2">
                    <div class="form-row">
                        <label for="items_active_2">æ¿€æ´»ç‹€æ…‹åœ–ç‰‡ <span class="required">*</span></label>
                        <input type="text" id="items_active_2" name="items_active_2" 
                               value="{{ form_data.get('items_active_2', '') }}" required
                               placeholder="çå“2æ¿€æ´»æ™‚çš„åœ–ç‰‡ç¶²å€">
                    </div>
                    
                    <div class="form-row">
                        <label for="items_idle_2">é–’ç½®ç‹€æ…‹åœ–ç‰‡ <span class="required">*</span></label>
                        <input type="text" id="items_idle_2" name="items_idle_2" 
                               value="{{ form_data.get('items_idle_2', '') }}" required
                               placeholder="çå“2é–’ç½®æ™‚çš„åœ–ç‰‡ç¶²å€">
                    </div>
                </div>
                
                <h6>çå“ 3</h6>
                <div class="form-grid-2">
                    <div class="form-row">
                        <label for="items_active_3">æ¿€æ´»ç‹€æ…‹åœ–ç‰‡ <span class="required">*</span></label>
                        <input type="text" id="items_active_3" name="items_active_3" 
                               value="{{ form_data.get('items_active_3', '') }}" required
                               placeholder="çå“3æ¿€æ´»æ™‚çš„åœ–ç‰‡ç¶²å€">
                    </div>
                    
                    <div class="form-row">
                        <label for="items_idle_3">é–’ç½®ç‹€æ…‹åœ–ç‰‡ <span class="required">*</span></label>
                        <input type="text" id="items_idle_3" name="items_idle_3" 
                               value="{{ form_data.get('items_idle_3', '') }}" required
                               placeholder="çå“3é–’ç½®æ™‚çš„åœ–ç‰‡ç¶²å€">
                    </div>
                </div>
            </div>



            
            <input type="submit" value="ğŸ å»ºç«‹å¯¶ç®±å»£å‘Š">
        </form>
    </div>

    <div class="preview-column">
        <div class="preview-section">
            <h3 style="color: #333; margin-bottom: 15px; font-size: 16px; font-weight: 600;">ğŸ å¯¶ç®±å»£å‘Šå³æ™‚é è¦½</h3>
            <div class="ad-preview-container">
                <div class="ad-preview-header">å»£å‘Š</div>
                <div class="ad-preview-main">
                    <div id="preview-treasure-box">
                        <div class="treasure-box-container">
                            <div class="treasure-items-row">
                                <img id="preview-item-1" class="treasure-item-preview" src="" alt="çå“1" style="display: none;">
                                <img id="preview-item-2" class="treasure-item-preview" src="" alt="çå“2" style="display: none;">
                                <img id="preview-item-3" class="treasure-item-preview" src="" alt="çå“3" style="display: none;">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="preview-main-title" class="ad-preview-title">ä¸»æ¨™é¡Œ</div>
                <div id="preview-subtitle" class="ad-preview-subtitle">æ–‡å­—æ•˜è¿°</div>
                <div class="ad-preview-footer">
                    <div id="preview-advertiser" class="ad-preview-advertiser">å»£å‘Šå•†</div>
                    <div id="preview-call-to-action" class="ad-preview-cta">è¡Œå‹•å‘¼ç±²æŒ‰éˆ•æ–‡å­—</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('ad-form');
        
        // å³æ™‚é è¦½æ›´æ–°
        function updatePreview() {
            // æ›´æ–°åŸºæœ¬è³‡è¨Š
            const mainTitle = document.getElementById('main_title').value || 'ä¸»æ¨™é¡Œ';
            const subtitle = document.getElementById('subtitle').value || 'æ–‡å­—æ•˜è¿°';
            const advertiser = document.getElementById('advertiser').value || 'å»£å‘Šå•†';
            const callToAction = document.getElementById('call_to_action').value || 'ç«‹å³äº†è§£';
            
            document.getElementById('preview-main-title').textContent = mainTitle;
            document.getElementById('preview-subtitle').textContent = subtitle;
            document.getElementById('preview-advertiser').textContent = advertiser;
            document.getElementById('preview-call-to-action').textContent = callToAction;
            
            // æ›´æ–°å¯¶ç®±é è¦½
            const backgroundUrl = document.getElementById('img_background').value;
            const previewContainer = document.getElementById('preview-treasure-box');
            
            // è¨­å®šèƒŒæ™¯
            if (backgroundUrl) {
                previewContainer.style.backgroundImage = `url(${backgroundUrl})`;
            } else {
                previewContainer.style.backgroundImage = '';
            }
            
            // æ›´æ–°ä¸‰å€‹çå“åœ–ç‰‡
            const items = [
                { id: 'preview-item-1', activeField: 'items_active_1', idleField: 'items_idle_1' },
                { id: 'preview-item-2', activeField: 'items_active_2', idleField: 'items_idle_2' },
                { id: 'preview-item-3', activeField: 'items_active_3', idleField: 'items_idle_3' }
            ];
            
            items.forEach(item => {
                const activeUrl = document.getElementById(item.activeField).value;
                const idleUrl = document.getElementById(item.idleField).value;
                const imgElement = document.getElementById(item.id);
                
                // å„²å­˜å…©ç¨®ç‹€æ…‹çš„ URL
                imgElement.dataset.idleSrc = idleUrl || '';
                imgElement.dataset.activeSrc = activeUrl || '';

                // å„ªå…ˆä½¿ç”¨é–’ç½®ç‹€æ…‹ä½œç‚ºé è¨­é¡¯ç¤º
                const initialUrl = idleUrl || activeUrl;
                
                if (initialUrl) {
                    imgElement.src = initialUrl;
                    imgElement.style.display = 'block';
                } else {
                    imgElement.style.display = 'none';
                }
            });
        }
        
        // è™•ç†å¯¶ç®±è¨­å®šæ‘ºç–ŠåŠŸèƒ½
        const treasureBoxToggle = document.querySelector('.treasure-box-toggle');
        const treasureBoxSection = document.querySelector('.treasure-box-section');
        
        treasureBoxToggle.addEventListener('click', function() {
            this.classList.toggle('collapsed');
            treasureBoxSection.classList.toggle('expanded');
        });
        
        // ç‚ºæ‰€æœ‰è¼¸å…¥æ¬„ä½æ·»åŠ äº‹ä»¶ç›£è½
        const inputs = form.querySelectorAll('input[type="text"], input[type="url"]');
        inputs.forEach(input => {
            input.addEventListener('input', updatePreview);
        });
        
        // ç‚ºé è¦½çå“åœ–ç‰‡æ·»åŠ é»æ“Šäº‹ä»¶
        document.querySelectorAll('.treasure-item-preview').forEach(item => {
            item.addEventListener('click', function() {
                const idleSrc = this.dataset.idleSrc;
                const activeSrc = this.dataset.activeSrc;

                // å¦‚æœæ²’æœ‰æ¿€æ´»åœ–ç‰‡ï¼Œå‰‡ä¸åŸ·è¡Œä»»ä½•æ“ä½œ
                if (!activeSrc) return;

                // å¦‚æœç•¶å‰æ˜¯æ¿€æ´»ç‹€æ…‹ï¼Œåˆ‡æ›å›é–’ç½®ç‹€æ…‹ï¼›å¦å‰‡åˆ‡æ›åˆ°æ¿€æ´»ç‹€æ…‹
                if (this.src === activeSrc) {
                    this.src = idleSrc;
                } else {
                    this.src = activeSrc;
                }
            });
        });

        // åˆå§‹é è¦½
        updatePreview();
        
        // è¡¨å–®é©—è­‰
        form.addEventListener('submit', function(e) {
            const requiredFields = [
                'adset_id', 'advertiser', 'main_title', 'landing_page',
                'image_path_m', 'image_path_s', 'img_background',
                'items_active_1', 'items_idle_1', 'items_active_2', 'items_idle_2',
                'items_active_3', 'items_idle_3'
            ];
            
            let isValid = true;
            requiredFields.forEach(fieldName => {
                const field = document.getElementById(fieldName);
                if (!field.value.trim()) {
                    field.style.borderColor = 'red';
                    isValid = false;
                } else {
                    field.style.borderColor = '';
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼');
            }
        });
        

    });
</script>
{% endblock %} 