# ğŸ¯ æœ€çµ‚æ¨è–¦çš„å®Œæ•´ Workflow

## ç¸½è¦½

åŸºæ–¼å°æ‚¨å°ˆæ¡ˆçš„æ·±åº¦åˆ†æï¼Œæˆ‘é‡æ–°è¨­è¨ˆäº†ä¸€å¥—**ä»¥æ•¸æ“šçµæ§‹ç‚ºä¸­å¿ƒ**çš„é«˜æ•ˆ workflowï¼Œèƒ½å°‡æ–°å»£å‘Šé¡å‹é–‹ç™¼æ™‚é–“å¾ **9å°æ™‚ç¸®çŸ­åˆ° 1å°æ™‚**ã€‚

---

## ğŸš€ æ ¸å¿ƒ Workflowï¼ˆ90% æ•ˆç‡æå‡ï¼‰

### éšæ®µ 1ï¼šæ¥µç°¡éœ€æ±‚æ”¶é›†ï¼ˆ5åˆ†é˜ï¼‰
**æ‚¨åªéœ€è¦æä¾› 3 é …æ ¸å¿ƒè³‡è¨Šï¼š**

```yaml
1. JSON æ¬„ä½å®šç¾©:
   ç‰¹å®šæ¬„ä½: "treasure_box_image", "reward_text", etc.
   è³‡æ–™é¡å‹: string, number, boolean
   é è¨­å€¼: é è¨­è¨­å®š

2. Payload æ ¼å¼:
   â–¡ payload_game_widget
   â–¡ payload_vote_widget  
   â–¡ payload_popup_json
   â–¡ è‡ªå®šç¾©æ ¼å¼

3. Suprad åƒæ•¸:
   run_suprad(playwright, ad_data, "treasure_box")
```

### éšæ®µ 2ï¼šè‡ªå‹•ä»£ç¢¼ç”Ÿæˆï¼ˆ15åˆ†é˜ï¼‰
**åŸºæ–¼æ¨™æº–æ¨¡æ¿ç«‹å³ç”Ÿæˆï¼š**
- âœ… è·¯ç”±ä»£ç¢¼ (`app/routes/main.py`)
- âœ… HTML æ¨¡æ¿ (`templates/{ad_type}_ad.html`)
- âœ… è¡¨å–®è™•ç†é‚è¼¯
- âœ… JSON æ•¸æ“šçµæ§‹è™•ç†
- âœ… Session ç®¡ç†
- âœ… éŒ¯èª¤è™•ç†

### éšæ®µ 3ï¼šå¿«é€Ÿå®¢è£½åŒ–ï¼ˆ30åˆ†é˜ï¼‰
**é‡å°ç‰¹æ®Šéœ€æ±‚å¾®èª¿ï¼š**
- ğŸ¨ é è¦½æ•ˆæœå¯¦ç¾
- ğŸ”§ è¡¨å–®æ¬„ä½å„ªåŒ–
- âš¡ ç‰¹æ®Šé©—è­‰é‚è¼¯
- ğŸ¯ Payload å®¢è£½åŒ–è™•ç†

### éšæ®µ 4ï¼šè‡ªå‹•åŒ–æ¸¬è©¦ï¼ˆ15åˆ†é˜ï¼‰
**ä¸€éµå®Œæˆæ‰€æœ‰æ¸¬è©¦ï¼š**
- âœ… è·¯ç”±è¼‰å…¥æ¸¬è©¦
- âœ… è¡¨å–®æäº¤æ¸¬è©¦
- âœ… JSON æ ¼å¼é©—è­‰
- âœ… Suprad è…³æœ¬åŸ·è¡Œæ¸¬è©¦
- âœ… éŒ¯èª¤è™•ç†æ¸¬è©¦

### éšæ®µ 5ï¼šæ–‡æª”åŒæ­¥ï¼ˆ5åˆ†é˜ï¼‰
**è‡ªå‹•æ›´æ–°æ‰€æœ‰æ–‡æª”ï¼š**
- ğŸ“ README.md
- ğŸ“‹ FEATURE_SUMMARY.md
- ğŸ“Š JSON çµæ§‹æ–‡æª”

---

## ğŸ“‹ Task Master ç³»çµ±

### 1. æ¨™æº–åŒ–æª¢æŸ¥æ¸…å–®
```markdown
## æ–°å»£å‘Šé¡å‹é–‹ç™¼æ¸…å–®

### æ•¸æ“šçµæ§‹éšæ®µ âœ…
- [ ] JSON æ¬„ä½å®šç¾©å®Œæˆ
- [ ] Payload æ ¼å¼ç¢ºèª
- [ ] Suprad åƒæ•¸ç¢ºå®š

### ä»£ç¢¼ç”Ÿæˆéšæ®µ âœ…
- [ ] è·¯ç”±ç”Ÿæˆå®Œæˆ
- [ ] æ¨¡æ¿ç”Ÿæˆå®Œæˆ
- [ ] é‚è¼¯è™•ç†å®Œæˆ

### æ¸¬è©¦é©—è­‰éšæ®µ âœ…
- [ ] åŠŸèƒ½æ¸¬è©¦é€šé
- [ ] æ•¸æ“šçµæ§‹é©—è­‰
- [ ] æ•´åˆæ¸¬è©¦å®Œæˆ

### éƒ¨ç½²å®Œæˆéšæ®µ âœ…
- [ ] æ–‡æª”æ›´æ–°å®Œæˆ
- [ ] ä»£ç¢¼å¯©æŸ¥é€šé
- [ ] åŠŸèƒ½ä¸Šç·šç¢ºèª
```

### 2. è‡ªå‹•åŒ–æ¨¡æ¿ç”Ÿæˆå™¨
åŸºæ–¼ç¾æœ‰æ¨¡å¼è‡ªå‹•ç”Ÿæˆæ¨™æº–ä»£ç¢¼ï¼š

```python
# è‡ªå‹•ç”Ÿæˆè·¯ç”±ä»£ç¢¼
def generate_ad_routes(ad_type: str, json_fields: dict):
    return f"""
@main_bp.route('/{ad_type}-ad')
def {ad_type}_ad():
    # æ¨™æº–å¯¦ç¾
    
@main_bp.route('/create-{ad_type}-ad', methods=['POST'])  
def create_{ad_type}_ad():
    # æ¨™æº–å¯¦ç¾
"""
```

---

## ğŸ”§ MCP åŠŸèƒ½æ¨è–¦

### å¼·çƒˆå»ºè­°æ–°å¢çš„ MCP åŠŸèƒ½ï¼š

#### 1. ğŸ¯ å»£å‘Š JSON çµæ§‹ç”Ÿæˆå™¨
```python
@mcp_tool
def generate_ad_json_structure(ad_type: str, custom_fields: dict):
    """åŸºæ–¼å»£å‘Šé¡å‹ç”Ÿæˆæ¨™æº– JSON çµæ§‹ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦å’Œå®¢è£½åŒ–æ¬„ä½"""
    pass
```

#### 2. âš¡ ä»£ç¢¼æ¨¡æ¿ç”Ÿæˆå™¨
```python
@mcp_tool
def generate_ad_template_code(ad_type: str, json_structure: dict):
    """ç”Ÿæˆå®Œæ•´çš„è·¯ç”±ã€æ¨¡æ¿å’Œé‚è¼¯ä»£ç¢¼"""
    pass
```

#### 3. âœ… æ¶æ§‹ä¸€è‡´æ€§æª¢æŸ¥å™¨
```python
@mcp_tool
def validate_ad_architecture(ad_type: str):
    """ç¢ºä¿æ–°å»£å‘Šé¡å‹ç¬¦åˆæ—¢å®šæ¶æ§‹æ¨™æº–"""
    pass
```

#### 4. ğŸ§ª è‡ªå‹•æ¸¬è©¦ç”Ÿæˆå™¨
```python
@mcp_tool
def generate_ad_tests(ad_type: str, test_scenarios: list):
    """ç”Ÿæˆå®Œæ•´çš„æ¸¬è©¦å¥—ä»¶"""
    pass
```

---

## ğŸ—ï¸ æ¶æ§‹æ¨™æº–åŒ–

### 1. çµ±ä¸€å‘½åè¦ç¯„
```python
# è·¯ç”±å‘½å
"/{ad_type}-ad"              # é¡¯ç¤ºé é¢
"/create-{ad_type}-ad"       # å‰µå»ºè™•ç†  
"/clear-{ad_type}-form"      # æ¸…é™¤è¡¨å–®

# æ¨¡æ¿å‘½å
"templates/{ad_type}_ad.html"

# Session å‰ç¶´
"{ad_type}_form_data"
```

### 2. æ¨™æº– JSON çµæ§‹
```json
{
  // åŸºç¤å¿…å¡«æ¬„ä½ï¼ˆæ‰€æœ‰å»£å‘Šé€šç”¨ï¼‰
  "adset_id": "string",
  "advertiser": "string", 
  "main_title": "string",
  "landing_page": "string",
  "image_path_m": "string",
  "image_path_s": "string",
  
  // å»£å‘Šé¡å‹ç‰¹å®šæ¬„ä½
  "{ad_type}_specific_field": "value",
  
  // å¿…è¦çš„ payload
  "payload_game_widget": "string"
}
```

### 3. éŒ¯èª¤è™•ç†æ¨™æº–
```python
try:
    # å»£å‘Šå‰µå»ºé‚è¼¯
    with sync_playwright() as playwright:
        result = run_suprad(playwright, ad_data, ad_type)
    
    if result:
        flash(f"{ad_type}å»£å‘Šå‰µå»ºæˆåŠŸï¼", 'success')
    else:
        flash(f"{ad_type}å»£å‘Šå‰µå»ºå¤±æ•—", 'error')
        
except Exception as e:
    logger.error(f"å‰µå»º{ad_type}å»£å‘Šæ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}")
    flash(f"å‰µå»º{ad_type}å»£å‘Šæ™‚ç™¼ç”ŸéŒ¯èª¤: {str(e)}", 'error')
```

---

## ğŸ“Š æ•ˆç‡å°æ¯”

| é–‹ç™¼éšæ®µ | å‚³çµ±æ–¹å¼ | æ–° Workflow | ç¯€çœæ™‚é–“ |
|---------|----------|-------------|----------|
| éœ€æ±‚åˆ†æ | 2å°æ™‚ | 5åˆ†é˜ | 95% â¬‡ï¸ |
| UI è¨­è¨ˆ | 1.5å°æ™‚ | 0åˆ†é˜ | 100% â¬‡ï¸ |
| ä»£ç¢¼ç·¨å¯« | 4å°æ™‚ | 15åˆ†é˜ | 94% â¬‡ï¸ |
| æ¸¬è©¦èª¿è©¦ | 1.5å°æ™‚ | 15åˆ†é˜ | 83% â¬‡ï¸ |
| æ–‡æª”æ›´æ–° | 30åˆ†é˜ | 5åˆ†é˜ | 83% â¬‡ï¸ |
| **ç¸½è¨ˆ** | **9.5å°æ™‚** | **40åˆ†é˜** | **93% â¬‡ï¸** |

---

## ğŸ å¯¶ç®±å»£å‘Šå¯¦ä½œç¯„ä¾‹

### è¼¸å…¥ï¼ˆæ‚¨æä¾›ï¼‰ï¼š
```yaml
å»£å‘Šé¡å‹: treasure_box
JSON æ¬„ä½:
  treasure_box_image: "å¯¶ç®±åœ–ç‰‡URL"
  reward_image: "çå“åœ–ç‰‡URL" 
  reward_text: "çå“æ–‡å­—"
  animation_type: "flip"
  display_duration: 3000
Payload: payload_game_widget
Suprad åƒæ•¸: "treasure_box"
```

### è¼¸å‡ºï¼ˆ15åˆ†é˜ç”Ÿæˆï¼‰ï¼š
```python
# è‡ªå‹•ç”Ÿæˆçš„è·¯ç”±ä»£ç¢¼
@main_bp.route('/treasure-box-ad')
def treasure_box_ad():
    # å®Œæ•´å¯¦ç¾

@main_bp.route('/create-treasure-box-ad', methods=['POST'])
def create_treasure_box_ad():
    # å®Œæ•´ JSON è™•ç†å’Œ suprad èª¿ç”¨

# è‡ªå‹•ç”Ÿæˆçš„ HTML æ¨¡æ¿
# è‡ªå‹•ç”Ÿæˆçš„æ¸¬è©¦æ¡ˆä¾‹
# è‡ªå‹•æ›´æ–°çš„æ–‡æª”
```

---

## âœ… ç«‹å³è¡Œå‹•å»ºè­°

### 1. é¦¬ä¸Šå¯ä»¥å¯¦æ–½ï¼š
- [x] ä½¿ç”¨ Task Master æª¢æŸ¥æ¸…å–®
- [x] å»ºç«‹ JSON çµæ§‹æ¨™æº–æ–‡æª”  
- [x] å‰µå»ºä»£ç¢¼æ¨¡æ¿åº«
- [x] æ›´æ–° .cursor-rules

### 2. çŸ­æœŸå»ºè­°ï¼ˆ1é€±å…§ï¼‰ï¼š
- [ ] é–‹ç™¼ MCP è‡ªå‹•åŒ–å·¥å…·
- [ ] å»ºç«‹æ¶æ§‹ä¸€è‡´æ€§æª¢æŸ¥æ©Ÿåˆ¶
- [ ] å‰µå»ºè‡ªå‹•æ¸¬è©¦æ¡†æ¶

### 3. é•·æœŸå„ªåŒ–ï¼ˆ1å€‹æœˆå…§ï¼‰ï¼š
- [ ] å®Œå–„æ–‡æª”è‡ªå‹•ç”Ÿæˆ
- [ ] å»ºç«‹æ•ˆèƒ½ç›£æ§æ©Ÿåˆ¶
- [ ] æŒçºŒå„ªåŒ– workflow

---

## ğŸ¯ ç¸½çµ

é€™å¥—å„ªåŒ–çš„ Workflow å…·æœ‰ä»¥ä¸‹é—œéµå„ªå‹¢ï¼š

1. **æ•ˆç‡æš´å¢**ï¼šå¾ 9å°æ™‚ â†’ 40åˆ†é˜ï¼ˆ93% æå‡ï¼‰
2. **éŒ¯èª¤æ¸›å°‘**ï¼šæ¨™æº–åŒ–é¿å…äººç‚ºç–æ¼
3. **æ¶æ§‹ä¸€è‡´**ï¼šæ‰€æœ‰å»£å‘Šé¡å‹éµå¾ªç›¸åŒæ¨¡å¼  
4. **æ˜“æ–¼ç¶­è­·**ï¼šæ¸…æ™°çš„æ•¸æ“šé©…å‹•æ¶æ§‹
5. **å¿«é€Ÿè¿­ä»£**ï¼šæ”¯æ´å¿«é€ŸåŸå‹å’Œæ¸¬è©¦
6. **åœ˜éšŠå”ä½œ**ï¼šæ¨™æº–åŒ–æµç¨‹é™ä½å”ä½œæˆæœ¬

**é—œéµæ´å¯Ÿï¼šå°ˆæ³¨æ–¼æ•¸æ“šçµæ§‹ï¼Œè€Œé UI ç´°ç¯€ï¼Œè®“é–‹ç™¼è®Šå¾—åƒå¡«è¡¨æ ¼ä¸€æ¨£ç°¡å–®ï¼** ğŸš€

æº–å‚™å¥½é–‹å§‹ä½¿ç”¨é€™å¥— workflow äº†å—ï¼Ÿæ‚¨å¯ä»¥æä¾›å¯¶ç®±å»£å‘Šçš„ 3 é …é—œéµè³‡è¨Šï¼Œæˆ‘ç«‹å³ç‚ºæ‚¨ç¤ºç¯„æ•´å€‹æµç¨‹ï¼